<!-- Local rules -->

<!-- Modify it at your will. -->
<!-- Copyright (C) 2015, Wazuh Inc. -->

<!-- Example -->
<group name="local,syslog,sshd,">

  <!--
  Dec 10 01:02:02 host sshd[1234]: Failed none for root from 1.1.1.1 port 1066 ssh2
  -->
  <rule id="100001" level="5">
    <if_sid>5716</if_sid>
    <srcip>1.1.1.1</srcip>
    <description>sshd: authentication failed from IP 1.1.1.1.</description>
    <group>authentication_failed,pci_dss_10.2.4,pci_dss_10.2.5,</group>
  </rule>

</group>
 <!-- ======================= -->
<!-- FIM Windows Downloads -->
<!-- ======================= -->

<group name="syscheck,windows,fim">

  <rule id="200005" level="10">
    <if_sid>550</if_sid>
    <field name="file">C:\\Users\\VM\\Downloads</field>
    <description>File modified in Windows Downloads directory</description>
  </rule>

  <rule id="200006" level="10">
    <if_sid>554</if_sid>
    <field name="file">C:\\Users\\VM\\Downloads</field>
    <description>File added in Windows Downloads directory</description>
  </rule>

  <rule id="200007" level="10">
    <if_sid>553</if_sid>
    <field name="file">C:\\Users\\VM\\Downloads</field>
    <description>File deleted in Windows Downloads directory</description>
  </rule>

<rule id="100016" level="3">
  <match>Linux-Sysmon</match>
  <description>Sysmon for Linux event collected</description>
  <group>syslog,journald,json</group>
</rule>

</group>
<group name="ai_alerts,">
  <!-- Base rule: AI ƒë·ªçc JSON t·ª´ active-responses.log (PH·∫¢I ƒê·∫∂T TR∆Ø·ªöC 100010) -->
  <rule id="100011" level="3">
    <decoded_as>json</decoded_as>
    <field name="ai_prediction">\.+</field>
    <description>AI Analysis: D·ªØ li·ªáu t·ª´ AI model</description>
  </rule>

  <!-- Rule cho test log ƒë·∫ßu v√†o (kh√¥ng ph·∫£i t·ª´ active-responses) -->
  <rule id="100010" level="3">
    <match>AI_TEST</match>
    <description>AI test log detected - ƒêang ph√¢n t√≠ch...</description>
    <group>web,apache,nginx,ids,ai_test_group,</group>
  </rule>

  <!-- XSS Detection - Level 14 (High) -->
  <rule id="100012" level="14">
    <if_sid>100011</if_sid>
    <field name="ai_prediction">^XSS$</field>
    <description>üö® AI PH√ÅT HI·ªÜN T·∫§N C√îNG XSS - ƒê·ªô tin c·∫≠y: $(ai_confidence_pct)% | XSS=$(ai_details.xss_pct)%, SQLi=$(ai_details.sqli_pct)%, Benign=$(ai_details.benign_pct)%</description>
    <group>attack,xss,ai_detection,</group>
  </rule>

  <!-- SQLi Detection - Level 14 (High) -->
  <rule id="100013" level="14">
    <if_sid>100011</if_sid>
    <field name="ai_prediction">^SQLi$</field>
    <description>üö® AI PH√ÅT HI·ªÜN T·∫§N C√îNG SQL INJECTION - ƒê·ªô tin c·∫≠y: $(ai_confidence_pct)% | SQLi=$(ai_details.sqli_pct)%, XSS=$(ai_details.xss_pct)%, Benign=$(ai_details.benign_pct)%</description>
    <group>attack,sqli,ai_detection,</group>
  </rule>

  <!-- Command Injection Detection - Level 14 (High) -->
  <rule id="100017" level="14">
    <if_sid>100011</if_sid>
    <field name="ai_prediction">^CMDi$</field>
    <description>üö® AI PH√ÅT HI·ªÜN T·∫§N C√îNG COMMAND INJECTION - ƒê·ªô tin c·∫≠y: $(ai_confidence_pct)% | CMDi=$(ai_details.cmdi_pct)%, SQLi=$(ai_details.sqli_pct)%, XSS=$(ai_details.xss_pct)%</description>
    <group>attack,cmdi,ai_detection,</group>
  </rule>

  <!-- Generic Attack (fallback) - Level 12 -->
  <rule id="100014" level="12">
    <if_sid>100011</if_sid>
    <field name="ai_is_attack">^true$</field>
    <description>‚ö†Ô∏è AI C·∫¢NH B√ÅO: Ph√°t hi·ªán $(ai_prediction) - ƒê·ªô tin c·∫≠y: $(ai_confidence_pct)%</description>
    <group>attack,ai_detection,</group>
  </rule>

  <!-- Override rule 31108 (level 0) to ensure POST requests are analyzed by AI -->
  <rule id="100019" level="6">
    <if_sid>31108</if_sid>
    <match>POST</match>
    <description>POST Request - AI Analysis Required (override 31108)</description>
    <group>web,apache,nginx,ids,attack,</group>
  </rule>

  <!-- Hook Rule: Forward ALL Web Logs to AI for analysis -->
  <rule id="100018" level="6">
    <decoded_as>web-accesslog</decoded_as>
    <description>Web Access Log - AI Analysis Required</description>
    <group>web,apache,nginx,ids,attack,</group>
  </rule>

  <!-- Benign - Level 3 (Info) -->
  <rule id="100015" level="3">
    <if_sid>100011</if_sid>
    <field name="ai_prediction">^Benign$</field>
    <description>AI: Request an to√†n (Benign: $(ai_details.benign_pct)%)</description>
    <group>ai_detection,</group>
  </rule>

</group>

